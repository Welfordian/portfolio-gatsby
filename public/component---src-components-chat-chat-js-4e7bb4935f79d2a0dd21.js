(self.webpackChunkgatsby_starter_default=self.webpackChunkgatsby_starter_default||[]).push([[317],{7228:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r},e.exports.__esModule=!0,e.exports.default=e.exports},379:function(e,t,a){var r=a(7228);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},9248:function(e,t,a){"use strict";a.r(t);var r=a(2982),n=a(4578),s=a(4217),o=a(6179),i=a(5186),c=(a(4280),a(4869)),l=a(4877),u=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={initialList:[],streams:[]},a}(0,n.Z)(t,e);var a=t.prototype;return a.connectToNewUser=function(e,t){var a=this,r=this.peer.call(e,t,{metadata:{userId:this.peer.id}});r.on("stream",(function(e){a.addVideoStream(e,!1,r.peer)}))},a.componentDidMount=function(){var e=this,t=setInterval.prototype;t=setInterval((function(){"Peer"in window&&(clearInterval(t),e.boot())}),200)},a.boot=function(){var e=this;this.socket=(0,c.io)("http://localhost:3030"),this.peer=new window.Peer(void 0,{path:"/peerjs",host:"localhost"}),this.socket.on("user-disconnected",(function(t){var a=e.state.streams.filter((function(e){return e.peer!==t}));e.setState({streams:a})})),this.socket.on("user-list",(function(t){e.setState({initialList:t})})),this.peer.on("open",(function(t){e.socket.emit("join-room",(0,l.jU)()?window.location.pathname.replace("/chat/",""):null,t)})),navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(t){e.addVideoStream(t,!0),e.peer.on("call",(function(a){a.answer(t),a.on("stream",(function(t){e.addVideoStream(t,!1,a.peer)}))})),e.state.initialList.forEach((function(a){a!==e.peer.id&&e.connectToNewUser(a,t)})),e.socket.on("user-connected",(function(a){e.connectToNewUser(a,t)}))}))},a.addVideoStream=function(e,t,a){var n=this;void 0===t&&(t=!1),void 0===a&&(a=null);var o=s.default.createRef(),i=this.state.streams.find((function(e){return e.peer===a}));if(void 0===i){var c=s.default.createElement("video",{playsInline:!0,muted:t,className:"rounded-lg object-cover self-start shadow-lg shadow-black/40 w-full",style:{transform:"rotateY(180deg)"},ref:o,onLoadedMetadata:function(){o.current.play()}});this.setState({streams:[].concat((0,r.Z)(this.state.streams),[{peer:a,video:c}])},(function(){n.forceUpdate(),o.current.srcObject=e}))}},a.render=function(){if((0,l.jU)()){var e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js",document.head.append(e)}return s.default.createElement("div",{className:"flex grow mt-32"},s.default.createElement(o.Z,{title:"Chat App"}),s.default.createElement("div",{className:"flex flex-col justify-between grow-0 w-full"},s.default.createElement("div",{className:"w-full bg-red-500 justify-center flex py-6 bg-gray-700 text-white"},s.default.createElement("p",{className:"text-xl"},"Video Chat"),s.default.createElement("div",{className:"w-12 h-12 resize"})),s.default.createElement("div",{className:"w-full bg-gray-800 grow items-stretch items-center justify-center flex"},s.default.createElement("div",{className:"w-full lg:columns-3 sm:columns-2 p-4"},this.state.streams.map((function(e){return s.default.createElement("div",{className:"w-full grow flex p-4 resize"},e.video)}))))),s.default.createElement(i.q,{htmlAttributes:{class:"chat-app"}}))},t}(s.default.Component);t.default=u}}]);
//# sourceMappingURL=component---src-components-chat-chat-js-4e7bb4935f79d2a0dd21.js.map