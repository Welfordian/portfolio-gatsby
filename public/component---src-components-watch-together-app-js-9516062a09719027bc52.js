"use strict";(self.webpackChunkgatsby_starter_default=self.webpackChunkgatsby_starter_default||[]).push([[751],{3086:function(e,t,n){n.r(t),n.d(t,{default:function(){return _}});var a=n(4578),s=n(4217),i=(n(2496),n(4869)),o=new(function(){function e(){this.watchers={}}var t=e.prototype;return t.emit=function(e,t){!e in this.watchers||this.watchers[e].forEach((function(e){e(t)}))},t.on=function(e,t){e in this.watchers||(this.watchers[e]=[]),this.watchers[e].push(t)},e}()),r=function(){function e(e,t){var n=this;this.app=e,this.socket=t,this.connect(),this.disconnect(),this.socket.onAny((function(e,t){e in n&&n[e](t)}))}var t=e.prototype;return t.connect=function(){var e=this;this.socket.on("connect",(function(){e.app.setState({connected:!0})}))},t.disconnect=function(){var e=this;this.socket.on("disconnect",(function(){e.app.setState({connected:!1})}))},t.set_video_id=function(e){var t=e.id;o.emit("set_video_id",{id:t})},t.cmd_clear_chat=function(){o.emit("cmd_clear_chat")},t.initial_response=function(e){var t=e.time,n=e.owner,a=e.socketId,s=e.videoId,i=e.users,r=n===a;o.emit("initial_response",{isOwner:r,time:t,owner:n,socketId:a,videoId:s,users:i})},t.system_message=function(e){o.emit("receive_chat",Object.assign({isSystemMessage:!0},e))},t.chat_message=function(e){o.emit("receive_chat",e)},t.disconnect_reason=function(e){var t=e.reason;alert(t)},t.set_video_time=function(e){o.emit("set_video_time",e)},t.presence_update_join=function(e){e.owner,e.socketId,e.videoId;var t=e.users;o.emit("presence_update",{online:Object.keys(t).length})},t.presence_update_leave=function(e){e.videoId;var t=e.users;o.emit("presence_update",{online:Object.keys(t).length})},e}(),c=function(){function e(e,t){this.app=e,this.socket=t}var t=e.prototype;return t.disconnect=function(){this.socket.disconnect()},t.setVideo=function(e){this.socket.emit("set_video_id",{id:e}),o.emit("set_video_id",{id:e})},t.sendChat=function(e){this.socket.emit("send_chat",{message:e})},t.updateTime=function(e,t){void 0===t&&(t=!1),this.socket.emit("set_video_time",{time:e,emit:t})},e}(),l=n(2776),u=n(5186),d=n(2982),h=n(7326),p=n(4280),f=n(4926),m=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={socketId:null,online:0,chat:[],eventEmitter:new c((0,h.Z)(n),n.props.socket)},o.on("initial_response",(function(e){var t=e.time,a=e.owner,s=e.socketId,i=e.videoId,o=e.users;n.setState({isOwner:a,socketId:s,startTime:t,videoId:i,online:Object.keys(o).length})})),o.on("receive_chat",(function(e){n.pushChat(Object.assign({},e,{self:e.sender===n.state.socketId}))})),o.on("presence_update",(function(e){var t=e.online;n.setState({online:t})})),o.on("cmd_clear_chat",(function(){n.setState({chat:[]})})),n}(0,a.Z)(t,e);var n=t.prototype;return n.sendChat=function(e){var t=e.target.value;this.clearMessage(),this.state.eventEmitter.sendChat(t)},n.clearMessage=function(){this.setState({chatMessage:""})},n.pushChat=function(e){this.setState({chat:[e].concat((0,d.Z)(this.state.chat))})},n.render=function(){var e=this;return s.default.createElement("div",{className:"bg-black dark:bg-gradient-to-tr dark:from-gray-800 dark:via-gray-700 dark:to-gray-900 grow text-white p-3 flex flex-col"},s.default.createElement("div",{className:"flex justify-between"},s.default.createElement("div",{className:"flex"},this.state.isOwner?s.default.createElement("div",{className:"flex"},s.default.createElement("div",{onClick:function(){return e.toggleLock()}},this.props.isLocked?s.default.createElement(p.G,{title:"Unlock room",icon:f.byT}):s.default.createElement(p.G,{title:"Lock room",icon:f.tAh}))):""),s.default.createElement("p",{className:"text-right"},this.state.online," Online Now")),s.default.createElement("div",{className:"flex flex-col flex-col-reverse grow mt-3"},s.default.createElement("input",{autoComplete:"off",value:this.state.chatMessage,placeholder:"Type to chat...",type:"text",className:"w-full text-black p-3",onChange:function(t){return e.setState({chatMessage:t.target.value})},onKeyUp:function(t){return"Enter"===t.code||"Enter"===t.key?e.sendChat(t):null}}),this.state.chat.map((function(e){return e.isSystemMessage?s.default.createElement("div",{className:"my-3 flex justify-center"},s.default.createElement("span",{className:"text-white text-sm border-t border-b py-2"},e.message)):s.default.createElement("div",{className:"my-3 flex flex-col  "+(e.self?"items-end":"items-start")},s.default.createElement("p",null,e.name),s.default.createElement("p",{className:"p-3 "+(e.self?"bg-white text-black":"bg-gray-600 text-white")},e.message))}))))},t}(s.default.Component),v=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={searchTimeout:setTimeout.prototype},n}(0,a.Z)(t,e);var n=t.prototype;return n.playVideo=function(e){if("Enter"===(e.code||e.key)){var t=/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/|shorts\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/.exec(this.props.searchTerm);null===t?(alert("Enter a valid YouTube video URL"),this.props.onChange("")):this.props.onVideoId(t[1])}},n.render=function(){var e=this;return s.default.createElement("input",{value:this.props.searchTerm,onChange:function(t){return e.props.onChange(t.target.value)},onKeyUp:function(t){return e.playVideo(t)},placeholder:"Search YouTube...",type:"text",className:"text-black placeholder-gray-500 border-4 border-black w-full p-2 text-lg"})},t}(s.default.Component),g=n(1465),y=n(239),w=function(e){function t(){var t;return(t=e.call(this)||this).state={newPosition:0},t}(0,a.Z)(t,e);var n=t.prototype;return n.playVideo=function(){this.props.onPlay()},n.pauseVideo=function(){this.props.onPause()},n.afterChange=function(){this.props.isOwner&&(this.setState({dragging:!1}),this.props.updateSeekPosition(this.state.newPosition))},n.render=function(){var e=this;return s.default.createElement("div",{className:"flex w-full bg-[#00000085] text-white p-4 gap-4 "+(this.props.isOwner?"-mt-[3.6rem]":"-mt-[2.8rem]")+" z-10 items-center"},this.props.isOwner?s.default.createElement(s.default.Fragment,null,this.props.playing?s.default.createElement("h1",{onClick:function(){e.pauseVideo()}},s.default.createElement(p.G,{icon:f.XQY})):s.default.createElement("h1",{onClick:function(){e.playVideo()}},s.default.createElement(p.G,{icon:f.zc}))):"",s.default.createElement(y.ZP,{progress:!0,min:0,max:this.props.duration,value:this.state.dragging?this.state.newPosition:this.props.position,onBeforeChange:function(){e.props.isOwner&&e.setState({dragging:!0})},onChange:function(t){e.props.isOwner&&e.setState({newPosition:t})},onAfterChange:this.afterChange.bind(this),className:"",trackStyle:{backgroundColor:"white"},railStyle:{backgroundColor:"gray"},handleStyle:{backgroundColor:"white",border:"none"}}))},t}(s.default.Component),k=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={updateInterval:setInterval.prototype,isOwner:!1,videoId:!1,player:!1,duration:!1,position:0,searchTerm:"",eventEmitter:new c((0,h.Z)(n),n.props.socket)},o.on("set_video_id",(function(e){var t=e.id;n.setState({searchTerm:"",videoId:t,playing:!0}),n.updateDuration()})),o.on("initial_response",(function(e){var t=e.isOwner,a=e.time,s=e.owner,i=e.socketId,o=e.videoId,r=e.users;n.setState({position:a,videoId:o,isOwner:s,socketId:i,users:r,playing:!0}),n.startUpdateInterval(t),n.updateSeekPosition(n.state.position)})),o.on("set_video_time",(function(e){return n.state.player.seekTo(e)})),n.waitForPlayer(),n}(0,a.Z)(t,e);var n=t.prototype;return n.startUpdateInterval=function(e){var t=this;void 0===e&&(e=!1),this.setState({isOwner:!0}),e&&this.setState({isOwner:!0,updateInterval:setInterval((function(){t.state.player&&t.state.eventEmitter.updateTime(t.state.player.getCurrentTime())}),10)}),this.waitForPlayer((function(){setInterval((function(){t.setState({positionForProgressBar:t.state.player.getCurrentTime()})}),100)}))},n.updateSeekPosition=function(e){var t=this;this.waitForPlayer((function(){t.state.isOwner&&(t.state.player.seekTo(e),t.state.eventEmitter.updateTime(e,!0))}))},n.waitForPlayer=function(e){var t=this;if(void 0===e&&(e=!1),!1===e)var n=setInterval((function(){t.state.player&&"playVideo"in t.state.player&&(clearInterval(n),t.state.player.playVideo(),t.state.player.seekTo(t.state.startTime),setTimeout((function(){t.state.player.unMute()}),800))}),50);else var a=setInterval((function(){t.state.player&&"playVideo"in t.state.player&&(clearInterval(a),e())}),50)},n.updateDuration=function(){var e=this;this.waitForPlayer((function(){e.setState({duration:e.state.player.getDuration()})}))},n.onVideoReady=function(e){this.setState({player:e.target}),this.updateDuration()},n.handlePlay=function(){this.state.isOwner&&(this.setState({playing:!0}),this.state.player.playVideo())},n.handlePause=function(){this.state.isOwner&&(this.setState({playing:!1}),this.state.player.pauseVideo())},n.render=function(){var e=this;return s.default.createElement("div",{className:"lg:col-span-2 grow-0 space-x-1"},s.default.createElement(v,{searchTerm:this.state.searchTerm,onChange:function(t){return e.setState({searchTerm:t})},onVideoId:function(t){e.state.eventEmitter.setVideo(t)}}),this.state.videoId?s.default.createElement("div",{className:"flex flex-col"},s.default.createElement("div",{className:"aspect-w-16 aspect-h-9 mt-4"},s.default.createElement(g.Z,{videoId:this.state.videoId,opts:{height:"100%",width:"100%",playerVars:{controls:0,mute:1,autoplay:1}},onReady:function(t){return e.onVideoReady(t)}}),s.default.createElement("div",{className:"flex"})),s.default.createElement(w,{playing:this.state.playing,isOwner:this.state.isOwner,player:this.state.player,duration:this.state.duration,position:this.state.positionForProgressBar,updateSeekPosition:function(t){e.updateSeekPosition(t)},onPlay:function(){return e.handlePlay()},onPause:function(){return e.handlePause()}})):"")},t}(s.default.Component),E="undefined"!=typeof window,_=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={modalOpen:!0,name:"",connected:!1,socketId:null,socket:null},n}(0,a.Z)(t,e);var n=t.prototype;return n.joinRoom=function(){var e;if(this.state.name.trim().length>3){this.setState({modalOpen:!1});var t=(0,i.io)(""+(null!==(e={}.SOCKET_URL)&&void 0!==e?e:"https://watch-together.welford.me"),{query:{roomid:E?window.location.pathname.replace("/watch-together/",""):null,name:this.state.name}});new r(this,t),this.setState({socket:t,eventEmitter:new c(this,t)})}else alert("Please enter a valid name...")},n.toggleLock=function(){this.setState({isLocked:!this.state.isLocked})},n.render=function(){var e=this;return s.createElement("div",{className:"mt-32"},this.state.modalOpen?s.createElement(l.Z,{title:"Enter a name",open:this.state.modalOpen,buttons:[s.createElement("button",{className:"bg-black text-white px-3 py-4 w-36",onClick:function(){return e.joinRoom()}},"Join")]},s.createElement("input",{autoComplete:"off",type:"text",className:"w-full px-2 py-3 text-lg",placeholder:"Jane Doe",onChange:function(t){return e.setState({name:t.target.value})},value:this.state.name})):this.state.connected?s.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 md:gap-4 grow flex l"},s.createElement(k,{socket:this.state.socket}),s.createElement(m,{socket:this.state.socket,socketId:this.state.socketId,online:this.state.online})):s.createElement("h1",{className:"text-4xl text-center dark:text-gray-300"},"Disconnected."),s.createElement(u.q,{htmlAttributes:{class:"watch-together"}}))},t}(s.Component)}}]);
//# sourceMappingURL=component---src-components-watch-together-app-js-9516062a09719027bc52.js.map