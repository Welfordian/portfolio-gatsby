{"version":3,"file":"component---src-components-chat-chat-js-03f2a10137e85ffe4315.js","mappings":"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","sources":["webpack://gatsby-starter-default/./node_modules/@babel/runtime/helpers/arrayLikeToArray.js","webpack://gatsby-starter-default/./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","webpack://gatsby-starter-default/./src/components/Chat/chat.js"],"sourcesContent":["function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import React from 'react';\nimport Seo from \"../seo\";\nimport {Helmet} from \"react-helmet\";\nimport {FontAwesomeIcon} from \"@fortawesome/react-fontawesome\";\nimport {faPaperPlane} from \"@fortawesome/pro-solid-svg-icons\";\nimport { io } from \"socket.io-client\";\nimport { isBrowser } from \"../../services/auth\";\n\n\nclass Chat extends React.Component {\n    constructor(props) {\n        super(props);\n        \n        this.state = {\n            initialList: [],\n            streams: [],\n        }\n    }\n\n    connectToNewUser (userId, stream) {\n        const call = this.peer.call(userId, stream, { metadata: { userId: this.peer.id } });\n\n        call.on(\"stream\", (userVideoStream) => {\n            this.addVideoStream(userVideoStream, false, call.peer);\n        });\n    }\n\n    componentDidMount() {\n        let waitForPeerInterval = setInterval.prototype;\n\n        waitForPeerInterval = setInterval(() => {\n            if (('Peer' in window)) {\n                clearInterval(waitForPeerInterval);\n                \n                this.boot();\n            }\n        }, 200);\n    }\n    \n    boot() {\n        this.socket = io('http://localhost:3030');\n\n        this.peer = new window.Peer(undefined, {\n            path: \"/peerjs\",\n            host: \"localhost\",\n        });\n\n        this.socket.on('user-disconnected', (userId) => {\n            let streams = this.state.streams.filter(stream => {\n                return stream.peer !== userId\n            })\n\n            this.setState({ streams })\n        })\n\n        this.socket.on('user-list', list => {\n            this.setState({ initialList: list })\n        })\n\n        this.peer.on(\"open\", (id) => {\n            this.socket.emit(\"join-room\", (isBrowser() ? window.location.pathname.replace('/chat/','') : null), id);\n        });\n\n        navigator.mediaDevices.getUserMedia({\n            audio: true,\n            video: true,\n        }).then((stream) => {\n            this.addVideoStream(stream, true);\n\n            this.peer.on(\"call\", (call) => {\n                call.answer(stream);\n\n                call.on(\"stream\", (userVideoStream) => {\n                    this.addVideoStream(userVideoStream, false, call.peer);\n                });\n            });\n\n            this.state.initialList.forEach(user => {\n                if (user !== this.peer.id) {\n                    this.connectToNewUser(user, stream);\n                }\n            })\n\n            this.socket.on(\"user-connected\", (userId) => {\n                this.connectToNewUser(userId, stream);\n            });\n        });\n    }\n\n    addVideoStream (stream, mute = false, peer = null) {\n        let videoRef = React.createRef();\n        \n        let foundPeer = this.state.streams.find(stream => {\n            return stream.peer === peer;\n        })\n        \n        if (foundPeer !== undefined) return;\n        \n        let video = (\n            <video\n                playsInline={true}\n                muted={mute}\n                className={`rounded-lg object-cover self-start shadow-lg shadow-black/40 w-full`}\n                style={{transform: 'rotateY(180deg)'}}\n                ref={videoRef}\n                onLoadedMetadata={() => { videoRef.current.play(); }}\n            ></video>\n        )\n\n        this.setState({\n            streams: [...this.state.streams, {peer, video}]\n        }, () => {\n            this.forceUpdate();\n            videoRef.current.srcObject = stream;\n        });\n    };\n\n    render() {        \n        if (isBrowser()) {\n            let script = document.createElement('script');\n            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js';\n            document.head.append(script);\n        }\n        \n        return (\n            <div className={`flex grow`}>\n                <Seo title=\"Chat App\" />\n\n                <div className={`flex flex-col justify-between grow-0 w-full`}>\n                    <div className={`w-full bg-red-500 justify-center flex py-6 bg-gray-700 text-white`}>\n                        <p className={`text-xl`}>Video Chat</p>\n                        \n                        <div className={`w-12 h-12 resize`}></div>\n                    </div>\n\n                    <div className={`w-full bg-gray-800 grow items-stretch items-center justify-center flex`}>\n                        <div className={`w-full lg:columns-3 sm:columns-2 p-4`}>\n                                {\n                                    this.state.streams.map(stream => {\n                                        return <div className={`w-full grow flex p-4 resize`}>{stream.video}</div>;\n                                    })\n                                }\n                        </div>\n\n                        {/*<div className={`bg-gray-600 w-4/12 flex-col hidden md:flex`}>*/}\n                        {/*    <div className={`flex grow`}>*/}\n                        {/*        */}\n                        {/*    </div>*/}\n                        {/*    */}\n                        {/*    <div className={`flex px-4 py-5 gap-3 items-center`}>*/}\n                        {/*        <input placeholder={`Type message here...`} className={`p-3 rounded-lg outline-none grow`} type={`text`} />*/}\n                        {/*        */}\n                        {/*        <button className={`px-4 py-3 bg-blue-500 text-white rounded-lg`}>*/}\n                        {/*            <FontAwesomeIcon icon={faPaperPlane}></FontAwesomeIcon>*/}\n                        {/*        </button>*/}\n                        {/*    </div>*/}\n                        {/*</div>*/}\n                    </div>\n                </div>\n                \n\n                <Helmet\n                    htmlAttributes={{\n                        class: 'chat-app',\n                    }}\n                />\n            </div>\n        );\n    }\n}\n\nexport default Chat"],"names":["module","exports","arr","len","length","i","arr2","Array","__esModule","arrayLikeToArray","o","minLen","n","Object","prototype","toString","call","slice","constructor","name","from","test","Chat","props","state","initialList","streams","connectToNewUser","userId","stream","this","peer","metadata","id","on","userVideoStream","addVideoStream","componentDidMount","waitForPeerInterval","setInterval","window","clearInterval","boot","socket","io","Peer","undefined","path","host","filter","setState","list","emit","isBrowser","location","pathname","replace","navigator","mediaDevices","getUserMedia","audio","video","then","answer","forEach","user","mute","videoRef","React","foundPeer","find","playsInline","muted","className","style","transform","ref","onLoadedMetadata","current","play","forceUpdate","srcObject","render","script","document","createElement","src","head","append","title","map","htmlAttributes","class"],"sourceRoot":""}