"use strict";(self.webpackChunkgatsby_starter_default=self.webpackChunkgatsby_starter_default||[]).push([[751],{2776:function(e,t,n){var a=n(4578),s=n(7294),i=function(e){function t(){return e.call(this)||this}return(0,a.Z)(t,e),t.prototype.render=function(){return s.createElement("div",{className:"relative z-10 "+(this.props.open?"":"hidden"),"aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},s.createElement("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),s.createElement("div",{className:"fixed z-10 inset-0 overflow-y-auto"},s.createElement("div",{className:"flex items-end sm:items-center justify-center min-h-full p-4 text-center sm:p-0"},s.createElement("div",{className:"relative bg-gray-800 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:max-w-lg sm:w-full"},s.createElement("div",{className:"px-4 pt-5 pb-5 sm:p-6 sm:pb-6"},s.createElement("div",{className:"sm:flex sm:items-start flex-grow"},s.createElement("div",{className:"mt-3 text-center sm:mt-0 sm:text-left flex-grow"},s.createElement("h3",{className:"text-xl leading-6 font-medium text-gray-200 mb-8",id:"modal-title"},this.props.title),s.createElement("div",{className:"mt-2"},this.props.children)))),s.createElement("div",{className:"bg-gray-800 px-4 py-3 sm:px-6 flex flex-row-reverse gap-3 mb-4"},this.props.buttons.map((function(e){return e})))))))},t}(s.Component);t.Z=i},3086:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var a=n(4578),s=n(7294),i=n(3801),o=n(4869),r=new(function(){function e(){this.watchers={}}var t=e.prototype;return t.emit=function(e,t){!e in this.watchers||this.watchers[e].forEach((function(e){e(t)}))},t.on=function(e,t){e in this.watchers||(this.watchers[e]=[]),this.watchers[e].push(t)},e}()),c=function(){function e(e,t){var n=this;this.app=e,this.socket=t,this.connect(),this.disconnect(),this.socket.onAny((function(e,t){e in n&&n[e](t)}))}var t=e.prototype;return t.connect=function(){var e=this;this.socket.on("connect",(function(){e.app.setState({connected:!0})}))},t.disconnect=function(){var e=this;this.socket.on("disconnect",(function(){e.app.setState({connected:!1})}))},t.set_video_id=function(e){var t=e.id;r.emit("set_video_id",{id:t})},t.cmd_clear_chat=function(){r.emit("cmd_clear_chat")},t.initial_response=function(e){var t=e.time,n=e.owner,a=e.socketId,s=e.videoId,i=e.users,o=n===a;r.emit("initial_response",{isOwner:o,time:t,owner:n,socketId:a,videoId:s,users:i})},t.system_message=function(e){r.emit("receive_chat",Object.assign({isSystemMessage:!0},e))},t.chat_message=function(e){r.emit("receive_chat",e)},t.disconnect_reason=function(e){var t=e.reason;alert(t)},t.set_video_time=function(e){r.emit("set_video_time",e)},t.presence_update_join=function(e){e.owner,e.socketId,e.videoId;var t=e.users;r.emit("presence_update",{online:Object.keys(t).length})},t.presence_update_leave=function(e){e.videoId;var t=e.users;r.emit("presence_update",{online:Object.keys(t).length})},e}(),l=function(){function e(e,t){this.app=e,this.socket=t}var t=e.prototype;return t.disconnect=function(){this.socket.disconnect()},t.setVideo=function(e){this.socket.emit("set_video_id",{id:e}),r.emit("set_video_id",{id:e})},t.sendChat=function(e){this.socket.emit("send_chat",{message:e})},t.updateTime=function(e,t){void 0===t&&(t=!1),this.socket.emit("set_video_time",{time:e,emit:t})},e}(),u=n(2776),d=n(5186),p=n(2982),m=n(7326),h=n(4280),f=n(4926),v=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={socketId:null,online:0,chat:[],eventEmitter:new l((0,m.Z)(n),n.props.socket)},r.on("initial_response",(function(e){var t=e.time,a=e.owner,s=e.socketId,i=e.videoId,o=e.users;n.setState({isOwner:a,socketId:s,startTime:t,videoId:i,online:Object.keys(o).length})})),r.on("receive_chat",(function(e){n.pushChat(Object.assign({},e,{self:e.sender===n.state.socketId}))})),r.on("presence_update",(function(e){var t=e.online;n.setState({online:t})})),r.on("cmd_clear_chat",(function(){n.setState({chat:[]})})),n}(0,a.Z)(t,e);var n=t.prototype;return n.sendChat=function(e){var t=e.target.value;this.clearMessage(),this.state.eventEmitter.sendChat(t)},n.clearMessage=function(){this.setState({chatMessage:""})},n.pushChat=function(e){this.setState({chat:[e].concat((0,p.Z)(this.state.chat))})},n.render=function(){var e=this;return s.createElement("div",{className:"bg-black grow text-white p-3 flex flex-col"},s.createElement("div",{className:"flex justify-between"},s.createElement("div",{className:"flex"},this.state.isOwner?s.createElement("div",{className:"flex"},s.createElement("div",{onClick:function(){return e.toggleLock()}},this.props.isLocked?s.createElement(h.G,{title:"Unlock room",icon:f.byT}):s.createElement(h.G,{title:"Lock room",icon:f.tAh}))):""),s.createElement("p",{className:"text-right"},this.state.online," Online Now")),s.createElement("div",{className:"flex flex-col flex-col-reverse grow mt-3"},s.createElement("input",{autoComplete:"off",value:this.state.chatMessage,placeholder:"Type to chat...",type:"text",className:"w-full text-black p-3",onChange:function(t){return e.setState({chatMessage:t.target.value})},onKeyUp:function(t){return"Enter"===t.code||"Enter"===t.key?e.sendChat(t):null}}),this.state.chat.map((function(e){return e.isSystemMessage?s.createElement("div",{className:"my-3 flex justify-center"},s.createElement("span",{className:"text-white text-sm border-t border-b py-2"},e.message)):s.createElement("div",{className:"my-3 flex flex-col  "+(e.self?"items-end":"items-start")},s.createElement("p",null,e.name),s.createElement("p",{className:"p-3 "+(e.self?"bg-white text-black":"bg-gray-600 text-white")},e.message))}))))},t}(s.Component),g=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={searchTimeout:setTimeout.prototype},n}(0,a.Z)(t,e);var n=t.prototype;return n.playVideo=function(e){if("Enter"===(e.code||e.key)){var t=/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/|shorts\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/.exec(this.props.searchTerm);null===t?(alert("Enter a valid YouTube video URL"),this.props.onChange("")):this.props.onVideoId(t[1])}},n.render=function(){var e=this;return s.createElement("input",{value:this.props.searchTerm,onChange:function(t){return e.props.onChange(t.target.value)},onKeyUp:function(t){return e.playVideo(t)},placeholder:"Search YouTube...",type:"text",className:"text-black placeholder-gray-500 border-4 border-black w-full p-2 text-lg"})},t}(s.Component),y=n(1465),w=n(615),k=function(e){function t(){var t;return(t=e.call(this)||this).state={newPosition:0},t}(0,a.Z)(t,e);var n=t.prototype;return n.playVideo=function(){this.props.onPlay()},n.pauseVideo=function(){this.props.onPause()},n.afterChange=function(){this.props.isOwner&&(this.setState({dragging:!1}),this.props.updateSeekPosition(this.state.newPosition))},n.render=function(){var e=this;return s.createElement("div",{className:"flex w-full bg-[#00000085] text-white p-4 gap-4 "+(this.props.isOwner?"-mt-[3.6rem]":"-mt-[2.8rem]")+" z-10 items-center"},this.props.isOwner?s.createElement(s.Fragment,null,this.props.playing?s.createElement("h1",{onClick:function(){e.pauseVideo()}},s.createElement(h.G,{icon:f.XQY})):s.createElement("h1",{onClick:function(){e.playVideo()}},s.createElement(h.G,{icon:f.zc}))):"",s.createElement(w.ZP,{progress:!0,min:0,max:this.props.duration,value:this.state.dragging?this.state.newPosition:this.props.position,onBeforeChange:function(){e.props.isOwner&&e.setState({dragging:!0})},onChange:function(t){e.props.isOwner&&e.setState({newPosition:t})},onAfterChange:this.afterChange.bind(this),className:"",trackStyle:{backgroundColor:"white"},railStyle:{backgroundColor:"gray"},handleStyle:{backgroundColor:"white",border:"none"}}))},t}(s.Component),E=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={updateInterval:setInterval.prototype,isOwner:!1,videoId:!1,player:!1,duration:!1,position:0,searchTerm:"",eventEmitter:new l((0,m.Z)(n),n.props.socket)},r.on("set_video_id",(function(e){var t=e.id;n.setState({searchTerm:"",videoId:t,playing:!0}),n.updateDuration()})),r.on("initial_response",(function(e){var t=e.isOwner,a=e.time,s=e.owner,i=e.socketId,o=e.videoId,r=e.users;n.setState({position:a,videoId:o,isOwner:s,socketId:i,users:r,playing:!0}),n.startUpdateInterval(t),n.updateSeekPosition(n.state.position)})),r.on("set_video_time",(function(e){return n.state.player.seekTo(e)})),n.waitForPlayer(),n}(0,a.Z)(t,e);var n=t.prototype;return n.startUpdateInterval=function(e){var t=this;void 0===e&&(e=!1),this.setState({isOwner:!0}),e&&this.setState({isOwner:!0,updateInterval:setInterval((function(){t.state.player&&t.state.eventEmitter.updateTime(t.state.player.getCurrentTime())}),10)}),this.waitForPlayer((function(){setInterval((function(){t.setState({positionForProgressBar:t.state.player.getCurrentTime()})}),100)}))},n.updateSeekPosition=function(e){var t=this;this.waitForPlayer((function(){t.state.isOwner&&(t.state.player.seekTo(e),t.state.eventEmitter.updateTime(e,!0))}))},n.waitForPlayer=function(e){var t=this;if(void 0===e&&(e=!1),!1===e)var n=setInterval((function(){t.state.player&&"playVideo"in t.state.player&&(clearInterval(n),t.state.player.playVideo(),t.state.player.seekTo(t.state.startTime),setTimeout((function(){t.state.player.unMute()}),800))}),50);else var a=setInterval((function(){t.state.player&&"playVideo"in t.state.player&&(clearInterval(a),e())}),50)},n.updateDuration=function(){var e=this;this.waitForPlayer((function(){e.setState({duration:e.state.player.getDuration()})}))},n.onVideoReady=function(e){this.setState({player:e.target}),this.updateDuration()},n.handlePlay=function(){this.state.isOwner&&(this.setState({playing:!0}),this.state.player.playVideo())},n.handlePause=function(){this.state.isOwner&&(this.setState({playing:!1}),this.state.player.pauseVideo())},n.render=function(){var e=this;return s.createElement("div",{className:"lg:col-span-2 grow-0 space-x-1"},s.createElement(g,{searchTerm:this.state.searchTerm,onChange:function(t){return e.setState({searchTerm:t})},onVideoId:function(t){e.state.eventEmitter.setVideo(t)}}),this.state.videoId?s.createElement("div",{className:"flex flex-col"},s.createElement("div",{className:"aspect-w-16 aspect-h-9 mt-4"},s.createElement(y.Z,{videoId:this.state.videoId,opts:{height:"100%",width:"100%",playerVars:{controls:0,mute:1,autoplay:1}},onReady:function(t){return e.onVideoReady(t)}}),s.createElement("div",{className:"flex"})),s.createElement(k,{playing:this.state.playing,isOwner:this.state.isOwner,player:this.state.player,duration:this.state.duration,position:this.state.positionForProgressBar,updateSeekPosition:function(t){e.updateSeekPosition(t)},onPlay:function(){return e.handlePlay()},onPause:function(){return e.handlePause()}})):"")},t}(s.Component),x="undefined"!=typeof window,b=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={modalOpen:!0,name:"",connected:!1,socketId:null,socket:null},n}(0,a.Z)(t,e);var n=t.prototype;return n.joinRoom=function(){var e;if(this.state.name.trim().length>3){this.setState({modalOpen:!1});var t=(0,o.io)(""+(null!==(e={}.SOCKET_URL)&&void 0!==e?e:"https://watch-together.welford.me"),{query:{roomid:x?window.location.pathname.replace("/watch-together/",""):null,name:this.state.name}});new c(this,t),this.setState({socket:t,eventEmitter:new l(this,t)})}else alert("Please enter a valid name...")},n.toggleLock=function(){this.setState({isLocked:!this.state.isLocked})},n.render=function(){var e=this;return s.createElement(i.Z,{hideSocial:!0,hideTagline:!0},this.state.modalOpen?s.createElement(u.Z,{title:"Enter a name",open:this.state.modalOpen,buttons:[s.createElement("button",{className:"bg-black text-white px-3 py-4 w-36",onClick:function(){return e.joinRoom()}},"Join")]},s.createElement("input",{autoComplete:"off",type:"text",className:"w-full px-2 py-3 text-lg",placeholder:"Jane Doe",onChange:function(t){return e.setState({name:t.target.value})},value:this.state.name})):this.state.connected?s.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 md:gap-4 grow flex l"},s.createElement(E,{socket:this.state.socket}),s.createElement(v,{socket:this.state.socket,socketId:this.state.socketId,online:this.state.online})):s.createElement("h1",{className:"text-4xl text-center"},"Disconnected."),s.createElement(d.q,{htmlAttributes:{class:"watch-together"}}))},t}(s.Component)}}]);
//# sourceMappingURL=component---src-components-watch-together-app-js-188a49b2baaf1d9a2edd.js.map