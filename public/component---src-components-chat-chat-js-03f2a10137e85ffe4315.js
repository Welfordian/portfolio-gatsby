(self.webpackChunkgatsby_starter_default=self.webpackChunkgatsby_starter_default||[]).push([[317],{7228:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},379:function(e,t,r){var n=r(7228);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},9248:function(e,t,r){"use strict";r.r(t);var n=r(2982),a=r(4578),s=r(7294),o=r(6179),i=r(5186),c=(r(4280),r(4869)),l=r(4877),u=function(e){function t(t){var r;return(r=e.call(this,t)||this).state={initialList:[],streams:[]},r}(0,a.Z)(t,e);var r=t.prototype;return r.connectToNewUser=function(e,t){var r=this,n=this.peer.call(e,t,{metadata:{userId:this.peer.id}});n.on("stream",(function(e){r.addVideoStream(e,!1,n.peer)}))},r.componentDidMount=function(){var e=this,t=setInterval.prototype;t=setInterval((function(){"Peer"in window&&(clearInterval(t),e.boot())}),200)},r.boot=function(){var e=this;this.socket=(0,c.io)("http://localhost:3030"),this.peer=new window.Peer(void 0,{path:"/peerjs",host:"localhost"}),this.socket.on("user-disconnected",(function(t){var r=e.state.streams.filter((function(e){return e.peer!==t}));e.setState({streams:r})})),this.socket.on("user-list",(function(t){e.setState({initialList:t})})),this.peer.on("open",(function(t){e.socket.emit("join-room",(0,l.jU)()?window.location.pathname.replace("/chat/",""):null,t)})),navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(t){e.addVideoStream(t,!0),e.peer.on("call",(function(r){r.answer(t),r.on("stream",(function(t){e.addVideoStream(t,!1,r.peer)}))})),e.state.initialList.forEach((function(r){r!==e.peer.id&&e.connectToNewUser(r,t)})),e.socket.on("user-connected",(function(r){e.connectToNewUser(r,t)}))}))},r.addVideoStream=function(e,t,r){var a=this;void 0===t&&(t=!1),void 0===r&&(r=null);var o=s.createRef(),i=this.state.streams.find((function(e){return e.peer===r}));if(void 0===i){var c=s.createElement("video",{playsInline:!0,muted:t,className:"rounded-lg object-cover self-start shadow-lg shadow-black/40 w-full",style:{transform:"rotateY(180deg)"},ref:o,onLoadedMetadata:function(){o.current.play()}});this.setState({streams:[].concat((0,n.Z)(this.state.streams),[{peer:r,video:c}])},(function(){a.forceUpdate(),o.current.srcObject=e}))}},r.render=function(){if((0,l.jU)()){var e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js",document.head.append(e)}return s.createElement("div",{className:"flex grow"},s.createElement(o.Z,{title:"Chat App"}),s.createElement("div",{className:"flex flex-col justify-between grow-0 w-full"},s.createElement("div",{className:"w-full bg-red-500 justify-center flex py-6 bg-gray-700 text-white"},s.createElement("p",{className:"text-xl"},"Video Chat"),s.createElement("div",{className:"w-12 h-12 resize"})),s.createElement("div",{className:"w-full bg-gray-800 grow items-stretch items-center justify-center flex"},s.createElement("div",{className:"w-full lg:columns-3 sm:columns-2 p-4"},this.state.streams.map((function(e){return s.createElement("div",{className:"w-full grow flex p-4 resize"},e.video)}))))),s.createElement(i.q,{htmlAttributes:{class:"chat-app"}}))},t}(s.Component);t.default=u}}]);
//# sourceMappingURL=component---src-components-chat-chat-js-03f2a10137e85ffe4315.js.map